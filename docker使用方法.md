## docker简介
* docker可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到其他机器。基于linux内核cgroup，namespace，对进程进行封装隔离，属于操作系统层面的虚拟化技术
* docker与虚拟机区别：虚拟机虚拟出硬件在其上运行一个完整操作系统，在该系统上再运行所需应用进程；容器内应用进程直接运行于宿主的内核，无自己内核，也不需进行硬件虚拟。
* 优势：
  1. 高效利用系统资源、快速启动、轻松迁移
  2. 一致的运行环境：由于开发环境、测试环境、生产环境不一致，导致有些bug并未在开发过程中被发现，docker提供了除内核外的完整运行环境，避免“这段代码在我电脑上没问题啊”这类问题
  3. 持续交付部署：开发人员通过dockerfile来进行镜像构建，并结合持续集成系统惊醒集成测试，运维人员可以直接在生产环境快速部署该镜像，甚至结合持续部署系统进行自动部署
  4. 轻松维护和扩展：使用分层存储以及镜像技术，使得应用重复部分的复用更为容易，也使得应用的维护更新更加简单

## docker基本概念
三个基本概念：镜像image、容器container、仓库repository，后面简称ima、con、rep
### docker image
* 操作系统分为内核和用户空间，对于linux内核启动后，会挂载root文件系统为其提供用户空间支持；而ima就相当于一个root文件系统
* ima是一个特殊的文件系统，除提供容器运行时所需的程序、库、资源、配置等文件，还包含一些为运行时准备的配置参数如匿名卷环境变量用户等，镜像不包含任何动态数据，其内容在构建后不会改变
* ima采用分层存储，因此在构建镜像时候需要注意：每一层尽量只包含该层需要添加的东西，任何额外的东西应该在该层构建结束前清理掉
### docker container
* ima与con关系即是类和实例的关系，ima是静态的定义，con是ima运行的实体，con可以被创建启动停止删除暂停
* con的实质是进程，但与在宿主执行的进程不同，con运行于自己独立的namespace，因此con拥有自己的文件系统网络配置进程空间甚至自己的用户id空间
* con也是分层存储，每一个con运行时，以ima为基础层，在其上创建一个当前con的存储层，该存储层为con运行时读写而准备，称为容器存储层，con不应该向其存储层写入任何数据，要求该 层保持无状态化，所有文件写入操作都应使用数据卷或者绑定宿主目录，在这些位置读写会跳过该层，直接对宿主或网络存储发生读写，其性能和稳定性更高
* 该层与con生存周期同，同存亡；数据卷的生存周期独立于con，容器消亡，数据卷不会消亡
### docker registry
* ima构建后很容易在宿主机上运行，但如需在其他服务器上使用ima则需要一个集中存储分发ima的服务，即docker registry
* 一个dr包含多个rep，每个rep包含多个标签tag，每个标签对应一个ima，即一个rep有多个ima。ubuntu：18.04，前面是仓库名，后边是tag版本号
* dr公开服务：开放给用户允许用户免费上传下载公开镜像，常用的是docker hub也是默认的registry，国内如阿里云网易云镜像等等
* 私有dr：用户本地搭建

## 使用docker镜像
docker运行con前需要本地存在对应ima，如果本地不存在，docker会从镜像仓库下载该ima
* 获取镜像：docker pull从docker hub上获取ima；docker run运行con
* 列出镜像：列出已下载的镜像：docker image ls，镜像id是唯一标识，一个镜像可以对应多个tag；docker system df